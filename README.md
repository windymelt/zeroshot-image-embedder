# DIY Google Photo

Query local photos using embedded vectors generated by OpenAI.

Of course, always alpha state because it's DIY.

## How it works?

- Explain photo using OpenAI API.
- Build embedding vector for the explanation using OpenAI API.
  - By default 1536 dimention per photo.
- Save vector to local `dict.cbor`. Vector is saved in CBOR binary format to keep file reasonably small.
- Repeat this for all photos inside directory.
  - Collocation: each directory have its own `dict.cbor`.
  - It makes easy to move
- Index photos into Meilisearch using vectors.
- When search, query string is vectorized using OpenAI API and do vector search to Meilisearch.

## Build

```sh
sbt assembly
```

## Usage

```sh
export OPENAI_TOKEN=...
```

### Generating dict

```sh
cd move/to/photo/dir
fd '.jpg' | xargs -I {} java -jar path/to/zeroshot-image-embedder/target/scala-3.6.4/zeroshot-image-embedder.jar {}
```

### Indexing

Start up Meilisearch.

```sh
docker compose up
curl \
  -X PATCH 'http://localhost:7700/indexes/photo_index/settings/embedders' \
  -H 'Content-Type: application/json'  \
  --data-binary '{
  "photoEmbedder": {
    "source":  "userProvided",
    "dimensions": 1536
  }
}'
```

```sh
scala-cli path/to/index.scala.sc
```

### Query

```sh
scala-cli path/to/search.scala.sc -- "tabby cat"
```